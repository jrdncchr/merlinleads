<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Cash Flow Analysis Calculator</title>
    <link href="resources/css/bootstrap.css" rel="stylesheet" />
    <script src="resources/js/jquery-1.11.2.min.js"></script>
</head>
<body>
    <style scoped="scoped">
        .calc-table {
            font-size: 12px !important;
        }
        .calc-table input {
            font-size: 12px !important;
        }
        input[type="text"]:disabled {
            background: white !important;
            border: 1px solid green;
        }
        input[type="text"]:enabled {
            background: lightyellow;
        }

        .calc-green {
            background-color: lightgreen;
        }
    </style>
    <table class="table table-bordered calc-table">
        <thead>
            <tr>
                <th>ARV</th>
                <th>Purchase<br />Price</th>
                <th>Cost of<br />Rehab</th>
                <th>Total<br />Cost</th>
                <th>LTV</th>
                <th>Rental<br />Income</th>
                <th>Vacancy<br />Rate(%)</th>
                <th>Monthly<br />Insurance</th>
                <th>Monthly<br />Taxes</th>
                <th>Maint.</th>
                <th>Prop<br />Manag.</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><input type="text" class="form-control" id="calc-arv" /></td>
                <td><input type="text" class="form-control" id="calc-purchase-price" /></td>
                <td><input type="text" class="form-control" id="calc-cost-of-rehab" /></td>
                <td class="calc-green"><input type="text" class="form-control" id="calc-total-cost" disabled /></td>
                <td class="calc-green"><input type="text" class="form-control" id="calc-ltv" disabled /></td>
                <td><input type="text" class="form-control" id="calc-rental-income" /></td>
                <td><input type="text" class="form-control" id="calc-vacancy-rate" /></td>
                <td><input type="text" class="form-control" id="calc-monthly-insurance" /></td>
                <td><input type="text" class="form-control" id="calc-monthly-taxes" /></td>
                <td><input type="text" class="form-control" id="calc-maint" /></td>
                <td><input type="text" class="form-control" id="calc-prop-manag" /></td>
            </tr>
        </tbody>
    </table>
    <br />

    <table class="table table-bordered calc-table">
        <thead>
        <tr>
            <th></th>
            <th>Percentage<br />Borrowed(%)</th>
            <th>Your<br />Money<br />Into Deal</th>
            <th>Loan<br />Amount</th>
            <th>Amort.<br />Period</th>
            <th>Interest<br/>Rate(%)</th>
            <th width="5%"></th>
            <th>P & I</th>
            <th>Cash<br />Flow</th>
            <th>Cash on<br />Cash<br />ROI</th>
        </tr>
        </thead>
        <tbody>
            <tr>
                <td>Paying Cash</td>
                <td><input class="form-control" type="text" id="calc-percent-0" /></td>
                <td class="calc-green"><input class="form-control" type="text" id="calc-ymid-0" disabled /></td>
                <td class="calc-green"><input class="form-control" type="text" id="calc-loan-amount-0" disabled /></td>
                <td><input class="form-control" type="text" id="calc-amort-period-0" /></td>
                <td><input class="form-control" type="text" id="calc-interest-rate-0" /></td>
                <td></td>
                <td class="calc-green"><input class="form-control" type="text" id="calc-pi-0" disabled /></td>
                <td class="calc-green"><input class="form-control" type="text" id="calc-cash-flow-0" disabled /></td>
                <td class="calc-green"><input class="form-control" type="text" id="calc-roi-0" disabled /></td>
            </tr>
            <tr>
                <td>Leverage</td>
                <td><input class="form-control" type="text" id="calc-percent-1" /></td>
                <td class="calc-green"><input class="form-control" type="text" id="calc-ymid-1" disabled /></td>
                <td class="calc-green"><input class="form-control" type="text" id="calc-loan-amount-1" disabled /></td>
                <td><input class="form-control" type="text" id="calc-amort-period-1" /></td>
                <td><input class="form-control" type="text" id="calc-interest-rate-1" /></td>
                <td></td>
                <td class="calc-green"><input class="form-control" type="text" id="calc-pi-1" disabled /></td>
                <td class="calc-green"><input class="form-control" type="text" id="calc-cash-flow-1" disabled /></td>
                <td class="calc-green"><input class="form-control" type="text" id="calc-roi-1" disabled /></td>
            </tr>
            <tr>
                <td>Leverage</td>
                <td><input class="form-control" type="text" id="calc-percent-2" /></td>
                <td class="calc-green"><input class="form-control" type="text" id="calc-ymid-2" disabled /></td>
                <td class="calc-green"><input class="form-control" type="text" id="calc-loan-amount-2" disabled /></td>
                <td><input class="form-control" type="text" id="calc-amort-period-2" /></td>
                <td><input class="form-control" type="text" id="calc-interest-rate-2" /></td>
                <td></td>
                <td class="calc-green"><input class="form-control" type="text" id="calc-pi-2" disabled /></td>
                <td class="calc-green"><input class="form-control" type="text" id="calc-cash-flow-2" disabled /></td>
                <td class="calc-green"><input class="form-control" type="text" id="calc-roi-2" disabled /></td>
            </tr>
            <tr>
                <td>Leverage</td>
                <td><input class="form-control" type="text" id="calc-percent-3" /></td>
                <td class="calc-green"><input class="form-control" type="text" id="calc-ymid-3" disabled /></td>
                <td class="calc-green"><input class="form-control" type="text" id="calc-loan-amount-3" disabled /></td>
                <td><input class="form-control" type="text" id="calc-amort-period-3" /></td>
                <td><input class="form-control" type="text" id="calc-interest-rate-3" /></td>
                <td></td>
                <td class="calc-green"><input class="form-control" type="text" id="calc-pi-3" disabled /></td>
                <td class="calc-green"><input class="form-control" type="text" id="calc-cash-flow-3" disabled /></td>
                <td class="calc-green"><input class="form-control" type="text" id="calc-roi-3" disabled /></td>
            </tr>
        </tbody>
    </table>
    <button onclick="cfa_calc()">Calculate</button>
</body>

<script>
    function cfa_calc() {
        var calc_arv = parseInt($('#calc-arv').val()),
                calc_purchase_price = parseInt($('#calc-purchase-price').val()),
                calc_cost_of_rehab = parseInt($('#calc-cost-of-rehab').val()),
                calc_rental_income = parseInt($('#calc-rental-income').val()),
                calc_vacancy_rate = parseInt($('#calc-vacancy-rate').val()),
                calc_monthly_insurance = parseInt($('#calc-monthly-insurance').val()),
                calc_monthly_taxes = parseInt($('#calc-monthly-taxes').val()),
                calc_maint = parseInt($('#calc-maint').val()),
                calc_prop_manag = parseInt($('#calc-prop-manag').val());

        //total cose
        var total_cost = calc_purchase_price + calc_cost_of_rehab;
        $('#calc-total-cost').val(total_cost);

        //ltv
        var ltv = Math.round((total_cost / calc_arv) * 100);
        $('#calc-ltv').val(ltv + "%");

        //ymid
        $('#calc-ymid-0').html("$" + total_cost);

        for(var i = 0; i <= 3; i++) {
            //ymid
            var cash_flow = 0, roi = 0, ymid = 0;
            var percent = $('#calc-percent-' + i).val();
            if(parseInt(percent) == 0 || percent == '') {
                ymid = total_cost;
                $('#calc-ymid-' + i).val(ymid);
                $('#calc-loan-amount-' + i).val(0);
                $('#calc-pi-' + i).val('');

                //cash flow
                cash_flow = calc_rental_income - Math.round(0) - (calc_rental_income * (calc_vacancy_rate / 100)) - calc_monthly_insurance - calc_monthly_taxes - calc_maint - calc_prop_manag;
                $('#calc-cash-flow-' + i).val(Math.round(cash_flow));

                roi = (cash_flow * 12 / ymid) * 100;
                $('#calc-roi-' + i).val(Math.round(roi) + '%');
            } else {
                percent = percent / 100;
                ymid = total_cost - (total_cost * percent);
                $('#calc-ymid-' + i).val(ymid);

                var loan_amount = total_cost * percent;
                $('#calc-loan-amount-' + i).val(loan_amount);

                //p&i
                var interest_rate = parseInt($('#calc-interest-rate-' + i).val());
                var amortization_period = parseInt($('#calc-amort-period-' + i).val());
                var pni = pmt((interest_rate / 100)/12, amortization_period*12, -loan_amount, 0, 0);
                $('#calc-pi-' + i).val(Math.round(pni));

                //cash flow
                cash_flow = calc_rental_income - Math.round(pni) - (calc_rental_income * (calc_vacancy_rate / 100)) - calc_monthly_insurance - calc_monthly_taxes - calc_maint - calc_prop_manag;
                $('#calc-cash-flow-' + i).val(Math.round(cash_flow));

                //roi
                roi = (cash_flow * 12 / ymid) * 100;
                $('#calc-roi-' + i).val(Math.round(roi) + '%');
            }
        }
    }

    function pmt(rate_per_period, number_of_payments, present_value, future_value, type){
        if(rate_per_period != 0.0){
            // Interest rate exists
            var q = Math.pow(1 + rate_per_period, number_of_payments);
            return -(rate_per_period * (future_value + (q * present_value))) / ((-1 + q) * (1 + rate_per_period * (type)));

        } else if(number_of_payments != 0.0){
            // No interest rate, but number of payments exists
            return -(future_value + present_value) / number_of_payments;
        }

        return 0;
    }
</script>
</html>